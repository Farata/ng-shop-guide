= NgShop. Step 1. Home Page.
:experimental:
:icons: font
:idprefix:
:idseparator: -
:imagesdir: step-1
:sectanchors:
:sectlinks:
:sectnums:
:toc:

== Bootstrapping the project

. _Optionally._ If you have yarn installed, specify it as the default Angular CLI package manager
+
[source, sh]
----
$ ng set --global packageManager=yarn
----

. Generate new project:
+
[source, sh]
----
$ ng new ng-shop --prefix ngs --style scss
----

. Add Angular Material to the project with one of the two following commands:
+
[source, sh]
----
# EITHER with yarn:
$ yarn add @angular/material -E           # <1>
# OR with npm:
$ npm install @angular/material --save -E # <1>
----
<1> `-E` denotes _exact_ version of the package with no http://semver.org/[semver] range operators applied.

. Add a prebuilt Angular Material theme to the _src/styles.css_ file:
+
[source, css]
----
@import '~@angular/material/core/theming/prebuilt/indigo-pink.css';
----

. Add `MaterialModule` to the imports section of the `AppModule` in the _src/app/app.module.ts_ file:
+
[source, js]
----
import { MaterialModule } from '@angular/material'; // <1>

@NgModule({
  declarations: [ AppComponent ],
  imports: [
    // Other modules...
    MaterialModule // <2>
  ],
  // Providers and bootstrap component...
})
export class AppModule {}
----

. Add the toolbar component in _src/app/app.component.html_:

. Launch the development server with `ng serve` command and open the app in a Web browser to make sure Angular Material is properly configured. You should be able to see a page with a default grey toolbar with the NgShop text aligned on the left:
+
.Angular Material Toolbar
image::fig_01.png[Toolbar,361,203,role="thumb"]

. Commit the changes to save the progress:
+
[source, sh]
----
$ git add -A && git commit -m "Add Angular Material package"
----

== Configuring custom Angular Material theme

. Create the directory _src/styles_:
+
[source, sh]
----
$ mkdir src/styles
----

. Move _src/styles.css_ file to the just created directory:
+
[source, sh]
----
$ mv src/styles.scss src/styles/styles.scss
----

. Create __palette.scss_ and _theme.scss_ files in the _src/styles_ folder:
+
[source, sh]
----
$ touch src/styles/_palette.scss
$ touch src/styles/theme.scss
----

. Put the styles below to the __palette.scss_ file:
+
[source, sass]
----
@import '~@angular/material/core/theming/theming';

// Define the palettes for your theme using the Material Design palettes
// available in palette.scss (imported above). For each palette, you can
// optionally specify a default, lighter, and darker hue.
$ngs-primary: mat-palette($mat-cyan);
$ngs-accent:  mat-palette($mat-cyan, A200, A100, A400);
$ngs-warn:    mat-palette($mat-red);

// Create the theme object (a Sass map containing all of the palettes).
$ngs-theme: mat-light-theme($ngs-primary, $ngs-accent, $ngs-warn);

$ngs-background: map-get($ngs-theme, background);
$ngs-foreground: map-get($ngs-theme, foreground);

$ngs-brand-font: 'Abril Fatface', cursive;
----

. Put the styles below to the _theme.scss_ file:
+
[source, sass]
----
@import url('https://fonts.googleapis.com/css?family=Abril+Fatface');
@import url('https://fonts.googleapis.com/icon?family=Material+Icons');
@import '~@angular/material/core/theming/all-theme';
@import './palette';

// Include the base styles for Angular Material core. We include this here so
// that you only have to load a single CSS file for Angular Material in your app.
@include mat-core();

// Include theme styles for core and each component used in your app.
// Alternatively, you can import and @include the theme mixins for each component
// that you are using.
@include angular-material-theme($ngs-theme);

md-ink-bar {
  background-color: mat-color($ngs-accent);
}

body {
  color: mat-color($ngs-foreground, text);
  font-family: $mat-font-family;
  font-size: rem(1.4);
}
----

. Replace content of the __styles.scss__ file:
+
[source, css]
----
body {
  margin: 0;
  padding: 0;
  height: 100%;
}
----

. Change value of the `apps[0].styles` array in the _.angular-cli.json_ file, it should list _styles.scss_ and _theme.scss_ files:
+
[source, json]
----
styles: [
  "styles/styles.scss",
  "styles/theme.scss"
]
----

. Restart development web server with kbd:[Ctrl+C] and `ng serve` to apply changes in _.angular-cli.json_ file.

. To make sure the theme is properly configured try to set attribute `color="primary"` for the `<md-toolbar>` element in the _src/app/app.component.html_ file. Open the app in a web browser you should see the toolbar with cyan background:
+
.Toolbar with cyan background
image::fig_02.png[Toolbar with cyan background,417,role="thumb"]
+
Remove `color="primary"` now since the background color of the toolbar in our application will be white.

. Now let's add the permanent version of toolbar that we'll be using in the app. First, copy _ngshop-logo.svg_ image from the handouts to the _src/assets_ folder:
+
[source, sh]
----
$ cp {path-to-handouts}/ngshop-logo.svg src/assets
----

. Replace content of the _src/app/app.component.ts_ with the following code:
+
[source, js]
----
import { Component } from '@angular/core';
import { DomSanitizer } from '@angular/platform-browser';
import { MdIconRegistry } from '@angular/material';

@Component({
  selector: 'ngs-app',
  styleUrls: [ './app.component.scss' ],
  templateUrl: './app.component.html',
})
export class AppComponent {

  constructor(
      private domSanitizer: DomSanitizer,
      private iconRegistry: MdIconRegistry) {
    this.registerIcons(new Map<string, string>([
      [ 'logo', 'assets/ngshop-logo.svg' ]
    ]));
  }

  private registerIcons(icons: Map<string, string>) {
    icons.forEach((url, id) => {
      const safeUrl = this.domSanitizer.bypassSecurityTrustResourceUrl(url);
      this.iconRegistry.addSvgIconInNamespace('ngs', id, safeUrl);
    });
  }
}
----

. Replace content of the _src/app/app.component.html_ file with the following HTML markup:
+
[source, html]
----
<md-toolbar>
  <span class="fill"></span>
  <a routerLink="/">
    <md-icon class="logo" svgIcon="ngs:logo"></md-icon>
  </a>
  <span class="fill"></span>
</md-toolbar>
----

. Replace content of the _src/app/app.component.scss_ files with following styles:
+
[source, sass]
----
@import '../styles/palette';

md-toolbar {
  background: mat-color($ngs-background, card);

  // This adds a bottom border. On the home page the tabs are rendered on top of the
  // shadow this makes the header look like a single component. On other pages, the
  // shadow is visible, so it separates header from the content.
  box-shadow: 0 1px mat-color($ngs-foreground, divider);
}

.fill {
  flex: 1 1 auto;
}

.logo {
  height: 36px;
  width: auto;
}
----
+
After applying the changes to the `AppComponent` the application should look like this in a web browser:
+
.Complete toolbar
image::fig_03.png[Complete toolbar,489,role="thumb"]

. Commit the changes to save the progress:
+
[source, sh]
----
$ git add -A && git commit -m "Add custom Angular Material theme"
----

== Adding static NgShop data

. Copy _data_ directory from the class handouts to the _src_ directory of NgShop project:
+
[source, sh]
----
$ cp -r {path-to-handouts}/data src
----

. Add `"data"` string to the the `apps[0].assets` array in the _.angular-cli.json_ file:
+
[source, json]
----
"assets": [
  "assets",
  "data",
  "favicon.ico"
],
----

. Restart development web server with kbd:[Ctrl+C] and `ng serve` to apply changes in _.angular-cli.json_ file.

. Commit the changes to save the progress:
+
[source, sh]
----
$ git add -A && git commit -m "Add static NgShop data"
----

== Implementing ProductService

. Create _src/app/shared/services_ directory:
+
[source, sh]
----
$ mkdir -p src/app/shared/services
----

. Generate the service with Angular CLI in the just created folder:
+
[source, sh]
----
$ ng generate service shared/services/product --spec false # <1>
# Shorthand: ng g s shared/services/product -spec false
----
<1> Note the specified path is relative to the _src/app_ directory.
+
Here is the command's output:
+
.Generate service command output
image::fig_04.png[Generate service command output,878,role="thumb"]

. Create _index.ts_ file in the _src/app/shared/services/product_ folder, put following code in there:
+
[source, js]
----
export * from './product.service';
----

. Replace content of the _product.service.ts_ file with the following code:
+
[source, js]
----
import { Injectable } from '@angular/core';
import { Http } from '@angular/http';
import { Observable } from 'rxjs/Observable';
import 'rxjs/add/operator/map';

@Injectable()
export class ProductService {

  constructor(private http: Http) {}

  getAll(): Observable<Product[]> {
    return this.http.get('/data/products/all.json')
      .map(resp => resp.json());
  }
}

export interface Product {
  description: string;
  featured: boolean;
  imageUrl: string;
  price: number;
  title: string;
  id: string;
}
----

. Add `ProductService` to the list of `AppModule` providers in the _src/app/app.module.ts_ file:
+
[source, js]
----
import { ProductService } from './shared/services'; // <1>

@NgModule({
  // Module declarations, imports go here...
  providers: [ ProductService ], // <2>
  bootstrap: [ AppComponent ]
})
export class AppModule {}
----
<1> Because of we created _src/app/shared/services/index.ts_ file we can use a shorter path here.
<2> Add `ProductService` here.

. To make sure the service is created properly try injecting into `AppComponent`, invoke `getAll()` method, and print result of the request into the console:
+
[source, js]
----
import { ProductService } from './shared/services';

@Component({...})
export class AppComponent {
  constructor(
      private domSanitizer: DomSanitizer,
      private iconRegistry: MdIconRegistry,
      productService: ProductService) {
    productService.getAll()                            // <1>
        .subscribe(products => console.log(products)); // <2>
    // Rest of the constructor's code...
  }
}
----
<1> Since observables are lazy `getAll()` doesn't trigger HTTP request immediately, it waits till someone subscribes to it.
<2> When the data arrives, print it to the console.
+
Launch the development web server, open the application in a web browser and take a look at the dev console, you should see an array of product objects printed there.
+
Remove `ProductService` from `AppComponent` since it won't be responsible for displaying products.

. Commit the changes to save the progress:
+
[source, sh]
----
$ git add -A && git commit -m "Add initial version of ProductService"
----

== Implementing the Home page
